{% extends 'blog/base.html' %}


{% block page_title %}{{ post.title }}{% endblock %}
{% block title %}{{ post.title }}{% endblock %}
{% block subtitle %}<h2>{{ post.subtitle }}</h2>{% endblock %}
{% block main_image %}{% if post.header_image %}{{ MEDIA_URL }}{{ post.header_image.url }}{% else %}{% load static %}{% static "blog/images/background.png" %}{% endif %}{% endblock %}
{% block meta %}
    <span class="meta">
        Posted by {{ post.author }} on
        {% if post.published_date %}
            {{ post.published_date |date:"F j, Y"}}
        {% endif %}
    </span>
{% endblock %}

{% block post_options %}
    {% if user.is_authenticated %}
        <br />
        {% if not post.published_date %}
                <a class="btn btn-default options-btn publish" href="{% url 'post_publish' slug=post.slug %}">Publish</a>
        {%  endif %}
        <a class="btn btn-default options-btn edit" href="{% url 'post_edit' slug=post.slug %}"><span class="glyphicon glyphicon-pencil">Edit Post</span></a>
        <a class="btn btn-default options-btn remove" href="{% url 'post_remove' slug=post.slug %}"><span class="glyphicon glyphicon-trash">Delete Post</span></a>
    {% endif %}
{% endblock %}

{% block content %}
    <div class="container">
          <div class="row">
            <div class="col-lg-10 col-md-10 mx-auto">
                <article>
                 {% autoescape off %}{{ post.text |safe }}{% endautoescape %}
                </article>
            </div>
      </div>
    </div>

     <div class="comment-separator">
        <div class="comment-separator-overlay"></div>
        <div class="post-info">
        <strong>Last updated on</strong> : {{ post.updated_date|date:"F j, Y" }}
            <br />
            <br />
            <strong>Category</strong> : {{ post.category }}
        <br />
            <br />
        <strong> By </strong>: {{ post.author }}
            <br />
            <br />
        </div>

        <a class="btn btn-default options-btn comment-btn" href="#new-comment">Add comment</a>
     </div>

    <div class="container">
        <div class="row">
            <div class="col-lg-8 col-md-8 mx-auto">
            {% if comments %}
            <h3 class="text-center">Comments</h3>
            {% endif %}
             {% for comment in comments %}
                  {% if user.is_authenticated or comment.approved_comment %}
                        <div class="comment">
                            <div class="date">Posted on {{ comment.created_date }}</div>
                             {% if not comment.approved_comment and user.is_authenticated %}
                                <a class="btn btn-default options-btn remove inline-btn" href="{% url 'comment_remove' pk=comment.pk %}">Remove</a>
                                <a class="btn btn-default options-btn publish inline-btn" href="{% url 'comment_approve' pk=comment.pk %}">Approve</a>
                            {% endif %}
                            By <strong>{{ comment.author }}</strong>
                            <br />
                            <div class="container">
                            {% autoescape off %}{{ comment.comment_body |safe }}{% endautoescape %}
                            </div>
                        {% if user.is_authenticated %}
                        <a class="btn btn-default options-btn edit inline-btn" href="{% url 'comment_edit' slug=post.slug pk=comment.pk %}">Edit</a>
                            {% endif %}
                        </div>

                 {% endif %}

            {% endfor %}

            <br /><hr />
            <h3 class="text-center" id="new-comment">New Comment</h3>
                <form class="add-comment-form" method="POST" action="{{ request.path }}#new-comment" role="form">
                    {% csrf_token %}
                          {{ comment_form.non_field_errors }}

                          <div class="add-comment">
                              <label class="add-comment-label" for="{{ comment_form.author.id_for_label }}"><em>Your Name</em></label>
                              {{ comment_form.author.errors }}
                              {{ comment_form.author}}
                          </div>
                        <br />
                        <div class="add-comment">
                            <label class="add-comment-label" for="{{ comment_form.comment_body.id_for_label }}"><em>Your Comment</em></label>
                                  {{ comment_form.comment_body.errors }}
                                  {{ comment_form.comment_body}}
                              </div>
                    <button class="btn btn-default options-btn comment-btn inline-btn" style="background-color: lightgrey; margin-top: 25px;" type="submit" style="color:black">Post Comment</button>
                </form>
            {% if is_posted %}
                <div style="text-align: center;">
                    <strong style="color:green;"> Comment Submitted! </strong> <br />
                    <em>Your comment won't show up because it pending approval.</em>
                </div>
            {% endif %}
            </div>
        </div>
     </div>
{% endblock %}